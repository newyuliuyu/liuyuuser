<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.liuyu.user.web.dao.RoleDao">

    <insert id="add">
		insert into u_role(id,name,roletype,systembuiltin)
		values(#{role.id},#{role.name},#{role.roleType.code},#{role.systemBuiltin})
	</insert>

    <insert id="addUserRoles">
        insert into u_user_x_role(userId,roleId)
        values
        <foreach collection="roles" item="item" index="index" separator=",">
            (#{userId},#{item.id})
        </foreach>
    </insert>

    <insert id="addUserRole">
        insert into u_user_x_role(userId,roleId)
        values(#{userId},#{role.id})
    </insert>

    <update id="update">
		update u_role
		set name=#{role.name},
		roletype=#{role.roleType.code},
		systembuiltin=#{role.systemBuiltin}
		where id=#{role.id}
	</update>

    <delete id="delete">
		delete from u_role where id=#{roleId}
	</delete>
    <delete id="delUserRoles">
		delete from u_user_x_role where userId=#{userId}
	</delete>

    <delete id="delUserRole">
		delete from u_user_x_role where userId=#{userId} and roleId=#{roleId}
	</delete>
    <delete id="delRoleUser">
		delete from u_user_x_role where roleId=#{roleId}
	</delete>


    <resultMap id="RoleMap" type="com.liuyu.user.web.domain.Role">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="systemBuiltin" column="systembuiltin"/>
        <association property="roleType" javaType="com.liuyu.user.web.domain.RoleType">
            <id property="code" column="roleTypeCode"/>
            <result property="name" column="roleTypeName"/>
            <result property="level" column="roleTypeLevel"/>
        </association>
    </resultMap>

    <select id="get" resultMap="RoleMap">
		select id,a.name,systembuiltin as systemBuiltin,
		b.code as roleTypeCode,
		b.name as roleTypeName,
		b.level as roleTypeLevel
		from u_role a
		inner join u_role_type b on a.roleType=b.code
		where a.id=#{roleId}
	</select>

    <select id="queryUserRoles" resultMap="RoleMap">
		select a.id,a.name,systembuiltin as systemBuiltin,a.roleType as roleTypeCode
		from u_role a
		inner join u_user_x_role b on a.id=b.roleId
		where b.userId=#{userId}
	</select>

    <select id="queryRoles" resultMap="RoleMap">
		select id,a.name,systembuiltin as systemBuiltin,
		b.code as roleTypeCode,
		b.name as roleTypeName,
		b.level as roleTypeLevel
		from u_role a
		inner join u_role_type b on a.roleType=b.code
	</select>
    <select id="queryRolesWithLevel" resultMap="RoleMap">
		select id,a.name,systembuiltin as systemBuiltin,
		b.code as roleTypeCode,
		b.name as roleTypeName,
		b.level as roleTypeLevel
		from u_role a
		inner join u_role_type b on a.roleType=b.code
		where b.level=#{level}
	</select>

    <select id="queryRoleTypes" resultType="com.liuyu.user.web.domain.RoleType">
		select code,name,level
		from u_role_type a
	</select>
    <select id="queryRoleTypeWithLevel" resultType="com.liuyu.user.web.domain.RoleType">
		select code,name,level
		from u_role_type a
		where a.level=#{level}
	</select>

</mapper>
